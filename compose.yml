services:
  api:
    image: observatorio/api-registro-femicidios
    build:
      context: .
      target: development
    volumes:
      - './package.json:/opt/project/package.json'
      - './package-lock.json:/opt/project/package-lock.json'
      - './knexfile.mjs:/opt/project/knexfile.mjs'
      - './src:/opt/project/src'
      - './bin:/opt/project/bin'
      - './spec:/opt/project/spec'
      - './migrations:/opt/project/migrations'
    ports:
      - '8080:8080'
    environment:
      - AUTH_GOOGLE_CLIENT_ID
      - AUTH_GOOGLE_CLIENT_SECRET
      - AUTH_PROVIDER_ACCEPTED_CLIENT_ID=1234
      - AUTH_PROVIDER_REDIRECT_URI=http://localhost:5173/oauth/cb
      - AUTH_PROVIDER_CODE_ENCRYPTION_SECRET=qM1Z5km9PF63E6uehLgJKztxpnhPE1Ag15Df1DwJrpY
      - AUTH_INTERNAL_KEY=9876
      - DB_CONNECTION_STRING=postgresql://vivas:nosqueremos@db:5432/observatorio-femicidios
      - SERVER_CANNONICAL_ORIGIN=http://localhost:8080

  db:
    image: postgres
    ports:
      - "5432:5432"
    volumes:
      - ./.db:/var/lib/postgresql/data
    environment:
      - POSTGRES_DB=observatorio-femicidios
      - POSTGRES_USER=vivas
      - POSTGRES_PASSWORD=nosqueremos
